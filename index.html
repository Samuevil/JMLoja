<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Josimar Soares</title>

  <link rel="icon" href="assets/images/LayoutLogo.png" type="image/png" />

  <!-- CSS -->
  <link rel="stylesheet" href="css/globals.css" />
  <link rel="stylesheet" href="css/navbar.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/hero.css" />
  <link rel="stylesheet" href="css/home.css" />
  <link rel="stylesheet" href="css/footer.css" />

  <!-- ANIMAÃ‡Ã•ES DE SLIDE HORIZONTAL -->
  <style>
    @keyframes slideOutToLeft {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(-20%); opacity: 0; }
    }
    @keyframes slideInFromRight {
      from { transform: translateX(20%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .slide-out {
      animation: slideOutToLeft 0.6s ease forwards;
    }
    .slide-in {
      animation: slideInFromRight 0.6s ease forwards;
    }
  </style>
</head>

<body class="bg-black text-white">
  <!-- âœ… Envolve todo o conteÃºdo principal, exceto o footer -->
  <div class="page-wrapper">
    <!-- NAVBAR -->
    <nav class="navbar" role="navigation" aria-label="NavegaÃ§Ã£o principal">
      <div class="navbar-inner">
        <!-- âœ… Logo com caminho relativo seguro -->
        <a href="./" class="logo">
          <img src="assets/logos/Logo1.png" alt="Logo Josimar Soares">
        </a>

        <!-- Controles mÃ³veis: Blog + Hamburguer -->
        <div class="nav-mobile-controls">
          <a href="https://www.josimarsoares.com.br/" target="_blank" rel="noopener" class="nav-blog-mobile">BLOG</a>
          <button class="menu-toggle" id="menuToggle" aria-label="Abrir menu">â˜°</button>
        </div>

        <!-- Menu desktop -->
        <nav class="nav-desktop" id="navDesktop" aria-label="Menu principal"></nav>
      </div>

      <!-- âœ… Container do menu mobile (compatÃ­vel com JS e CSS) -->
      <div class="dropdown" id="mobileDropdown"></div>
    </nav>

    <div class="navbar-spacer"></div>

    <!-- HERO -->
    <section id="hero" aria-hidden="true">
      <div class="hero-bg"></div>
      <div class="hero-face">
        <img src="assets/images/Rosto.png" alt="Josimar Soares">
      </div>
      <div class="hero-content">
        <h1 id="hero-title"></h1>
        <p id="hero-subtitle"></p>
        <div class="hero-product">
          <img id="hero-image" src="" alt="">
        </div>
        <a id="hero-button" class="hero-button" href="#">Veja Mais</a>
      </div>
    </section>

    <!-- CONTEÃšDO PRINCIPAL -->
    <main id="homeContent" aria-live="polite"></main>
  </div> <!-- âœ… .page-wrapper fecha aqui -->

  <!-- FOOTER -->
  <footer id="footerContainer" role="contentinfo"></footer>

  <!-- UTILS -->
  <script src="js/utils.js" defer></script>
  <script src="js/categories.js" defer></script>
  <script src="js/products_data.js" defer></script>
  <script src="js/navbar.js" defer></script>
  <script src="js/main.js" defer></script>
  <script src="js/hero.js" defer></script>
  <script src="js/render.carousel.js" defer></script>
  <script src="js/render.products.js" defer></script>
  <script src="js/render.footer.js" defer></script>

  <!-- FUNÃ‡Ã•ES DE APOIO -->
  <script>
    function getAllChildSlugs(targetSlug) {
      const slugs = new Set();
      for (const group of categoryGroups) {
        if (group.slug === targetSlug) {
          group.columns?.forEach(col => {
            col.items?.forEach(item => slugs.add(item.slug));
          });
          return Array.from(slugs);
        }
        for (const col of group.columns || []) {
          if (col.slug === targetSlug) {
            col.items?.forEach(item => slugs.add(item.slug));
            return Array.from(slugs);
          }
        }
      }
      return null;
    }

    function getCategoryNameBySlug(slug) {
      for (const group of categoryGroups) {
        for (const col of group.columns || []) {
          for (const item of col.items || []) {
            if (item.slug === slug) {
              return item.name;
            }
          }
        }
      }
      for (const group of categoryGroups) {
        for (const col of group.columns || []) {
          if (col.slug === slug) {
            return col.title;
          }
        }
      }
      for (const group of categoryGroups) {
        if (group.slug === slug) {
          return group.title;
        }
      }
      return slug.replace(/-/g, " ").replace(/\b\w/g, l => l.toUpperCase());
    }
  </script>

  <!-- INICIALIZAÃ‡ÃƒO FINAL -->
  <script defer>
    document.addEventListener("DOMContentLoaded", () => {
      const home = document.getElementById("homeContent");
      const hero = document.getElementById("hero");
      if (!home) return;

      home.innerHTML = "";

      const urlParams = new URLSearchParams(window.location.search);
      const categorySlug = urlParams.get("category");

      if (hero) {
        hero.style.display = categorySlug ? "none" : "block";
        hero.setAttribute("aria-hidden", categorySlug ? "true" : "false");
      }

      let productsToShow = PRODUCTS;
      let sectionTitle = "Todos os produtos";

      if (categorySlug) {
        const isLeaf = PRODUCTS.some(p => p.category === categorySlug);
        if (isLeaf) {
          productsToShow = PRODUCTS.filter(p => p.category === categorySlug);
          sectionTitle = getCategoryNameBySlug(categorySlug);
        } else {
          const childSlugs = getAllChildSlugs(categorySlug);
          if (childSlugs && childSlugs.length > 0) {
            productsToShow = PRODUCTS.filter(p => childSlugs.includes(p.category));
            sectionTitle = getCategoryNameBySlug(categorySlug);
          } else {
            productsToShow = [];
            sectionTitle = "Categoria nÃ£o encontrada";
          }
        }
      }

      if (!categorySlug) {
        renderFeaturedProducts("homeContent", PRODUCTS);
        const video = document.createElement("section");
        video.className = "video-section";
        video.innerHTML = `
          <h2 class="video-title">
            <span class="orange">PARE DE DESPERDIÃ‡AR DINHEIRO!</span><br>
            <span>CONFIRA OS MELHORES PATINS POR ATÃ‰</span><br>
            <span class="orange">R$ 1500</span>
          </h2>
          <div class="video-container">
            <iframe src="https://www.youtube.com/embed/Dgm-0HwMKK4?autoplay=1&mute=1&rel=0" allow="autoplay" allowfullscreen></iframe>
          </div>
          <p class="video-hint">ðŸ”Š Clique no vÃ­deo para ativar o som</p>
        `;
        home.appendChild(video);
      }

      renderAllProducts("homeContent", productsToShow, sectionTitle);
      renderFooter("footerContainer");
    });
  </script>
</body>
</html>